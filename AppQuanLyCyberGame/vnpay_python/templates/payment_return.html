{% extends "base_layout.html" %}
{% block content %}
    <div class="panel panel-default">
        <div class="panel-heading">{{ title }}: {{ result }}</div>
        <div class="panel-body">
            <p>order_id:{{ order_id }}</p>
            <p>amount:{{ amount }}</p>
            <p>order_desc:{{ order_desc }}</p>
            <p>vnp_TransactionNo:{{ vnp_TransactionNo }}</p>
            {% if vnp_ResponseCode == '00' %}
                <p>vnp_ResponseCode: {{ vnp_ResponseCode }} - Thành công</p>
            {% else %}
                <p>vnp_ResponseCode: {{ vnp_ResponseCode }} - Lỗi</p>
            {% endif %}
            {% if msg %}
                <p class="alert-warning"> {{ msg }}</p>
            {% endif %}
            <form id="confirmForm" method="post" action="http://localhost:5000/ok">
                {% csrf_token %}
                <input type="hidden" name="order_id" value="{{ order_id }}">
                <input type="hidden" name="amount" value="{{ amount }}">
                <input type="hidden" name="order_desc" value="{{ order_desc }}">
                <input type="hidden" name="vnp_TransactionNo" value="{{ vnp_TransactionNo }}">
                <input type="hidden" name="vnp_ResponseCode" value="{{ vnp_ResponseCode }}">
                <div class="form-group">
                    <label for="user_id">ID Người dùng:</label>
                    <input type="text" class="form-control" id="user_id" name="user_id">
                </div>
                <button type="submit" class="btn btn-primary">Xác nhận</button>
            </form>
        </div>
    </div>
{% endblock %}

<script>
    document.getElementById("confirmForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Ngăn chặn việc submit form mặc định

        var form = event.target;
        var formData = new FormData(form);

        fetch(form.action, {
            method: form.method,
            body: formData
        }).then(function(response) {
            if (response.ok) {
                // Xử lý khi gửi dữ liệu thành công
                // Ví dụ: Hiển thị thông báo thành công cho người dùng
                alert("Dữ liệu đã được gửi thành công!");
            } else {
                // Xử lý khi gửi dữ liệu thất bại
                // Ví dụ: Hiển thị thông báo lỗi cho người dùng
                alert("Có lỗi xảy ra khi gửi dữ liệu!");
            }
        }).catch(function(error) {
            // Xử lý khi có lỗi xảy ra trong quá trình gửi dữ liệu
            console.error("Lỗi: ", error);
        });
    });
</script>
